{"version":3,"sources":["file:///G:/sxbs2/sxbs2/assets/work/initialize/view/LoadingViewComp.ts"],"names":["_decorator","sys","oops","ecs","CCVMParentComp","UIID","ccclass","property","LoadingViewComp","register","data","finished","total","progress","prompt","reset","setTimeout","gui","remove","Loading","open","Login","start","isNative","enter","addEvent","loadRes","onHandler","event","args","loadCustom","loadGameRes","language","getLangByID","Promise","resolve","reject","res","loadDir","onProgressCallback","bind","onCompleteCallback","item","toFixed","ent"],"mappings":"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","sourcesContent":["/*\r\n * @Author: dgflash\r\n * @Date: 2021-07-03 16:13:17\r\n * @LastEditors: dgflash\r\n * @LastEditTime: 2022-08-29 13:37:08\r\n */\r\nimport { _decorator, sys } from \"cc\";\r\nimport { oops } from \"db://assets/core/Oops\";\r\nimport { ecs } from \"db://assets/libs/ecs/ECS\";\r\nimport { CCVMParentComp } from \"db://assets/module/common/CCVMParentComp\";\r\nimport { UIID } from \"../../ui/UIConfig\";\r\n\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n/** 游戏资源加载 */\r\n@ccclass('LoadingViewComp')\r\n@ecs.register('LoadingView', false)\r\nexport class LoadingViewComp extends CCVMParentComp {\r\n    /** VM 组件绑定数据 */\r\n    data: any = {\r\n        /** 加载资源当前进度 */\r\n        finished: 0,\r\n        /** 加载资源最大进度 */\r\n        total: 0,\r\n        /** 加载资源进度比例值 */\r\n        progress: \"0\",\r\n        /** 加载流程中提示文本 */\r\n        prompt: \"\"\r\n    };\r\n\r\n    private progress: number = 0;\r\n\r\n    reset(): void {\r\n        setTimeout(() => {\r\n            // 关闭加载界面\r\n            oops.gui.remove(UIID.Loading);\r\n\r\n            // 打开游戏主界面（自定义逻辑）\r\n            oops.gui.open(UIID.Login);\r\n        }, 500);\r\n    }\r\n\r\n    start() {\r\n\r\n        if (!sys.isNative) {\r\n            this.enter();\r\n        }\r\n    }\r\n\r\n    enter() {\r\n\r\n        this.addEvent();\r\n        this.loadRes();\r\n    }\r\n\r\n    private addEvent() {\r\n        // this.on(GameEvent.LoginSuccess, this.onHandler, this);\r\n    }\r\n\r\n    private onHandler(event: string, args: any) {\r\n        switch (event) {\r\n            // case GameEvent.LoginSuccess:\r\n            //     // 加载流程结束，移除加载提示界面\r\n            //     this.ent.remove(LoadingViewComp);\r\n            //     break;\r\n        }\r\n    }\r\n\r\n    /** 加载资源 */\r\n    private async loadRes() {\r\n        this.data.progress = 0;\r\n        await this.loadCustom();\r\n        this.loadGameRes();\r\n    }\r\n\r\n    /** 加载游戏本地JSON数据（自定义内容） */\r\n    private loadCustom() {\r\n        // 加载游戏本地JSON数据的多语言提示文本\r\n        this.data.prompt = oops.language.getLangByID(\"loading_load_json\");\r\n\r\n        return new Promise(async (resolve, reject) => {\r\n            // await JsonUtil.loadAsync(TableRoleJob.TableName);\r\n            // await JsonUtil.loadAsync(TableRoleLevelUp.TableName);\r\n            resolve(null);\r\n        });\r\n    }\r\n\r\n    /** 加载初始游戏内容资源 */\r\n    private loadGameRes() {\r\n        // 加载初始游戏内容资源的多语言提示文本\r\n        this.data.prompt = oops.language.getLangByID(\"loading_load_game\");\r\n\r\n        oops.res.loadDir(\"ui\", this.onProgressCallback.bind(this), this.onCompleteCallback.bind(this));\r\n    }\r\n\r\n    /** 加载进度事件 */\r\n    private onProgressCallback(finished: number, total: number, item: any) {\r\n        this.data.finished = finished;\r\n        this.data.total = total;\r\n\r\n        var progress = finished / total;\r\n        if (progress > this.progress) {\r\n            this.progress = progress;\r\n            this.data.progress = (progress * 100).toFixed(2);\r\n        }\r\n    }\r\n\r\n    /** 加载完成事件 */\r\n    private onCompleteCallback() {\r\n        // 获取用户信息的多语言提示文本\r\n        this.data.prompt = oops.language.getLangByID(\"loading_load_player\");\r\n\r\n        this.ent.remove(LoadingViewComp);\r\n        // 初始化帐号模块\r\n        // smc.account.connect();\r\n    }\r\n}"]}