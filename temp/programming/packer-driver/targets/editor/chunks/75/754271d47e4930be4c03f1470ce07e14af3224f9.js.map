{"version":3,"sources":["file:///E:/sxbs2/sxbs2/assets/script/core/gui/layer/LayerManager.ts"],"names":["LayerManager","Camera","Layers","Node","ResolutionPolicy","Widget","screen","view","warn","oops","DelegateComponent","LayerDialog","LayerNotify","LayerPopUp","LayerUI","ScreenAdapterType","LayerType","initScreenAdapter","drs","getDesignResolutionSize","ws","windowSize","windowAspectRatio","width","height","designAspectRatio","finalW","finalH","log","logView","setDesignResolutionSize","UNKNOWN","constructor","root","camera","game","guide","ui","popup","dialog","system","notify","configs","getComponentInChildren","create_node","Game","UI","PopUp","Dialog","System","Notify","Guide","addChild","init","setOpenFailure","callback","onOpenFailure","toast","content","useI18n","waitOpen","waitClose","setConfig","uiId","config","open","uiArgs","callbacks","layer","add","openAsync","Promise","resolve","reject","onAdded","node","params","onLoadFailure","replace","removeUiId","openUiId","remove","replaceAsync","has","result","prefab","get","isDestroy","removeByNode","comp","getComponent","vp","parent","removeCache","destroy","clear","name","Enum","UI_2D","w","addComponent","isAlignLeft","isAlignRight","isAlignTop","isAlignBottom","left","right","top","bottom","alignMode","enabled"],"mappings":"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","sourcesContent":["//cpall\r\nimport { Camera, Layers, Node, ResolutionPolicy, Widget, screen, view, warn } from \"cc\";\r\nimport { oops } from \"../../Oops\";\r\nimport { UICallbacks } from \"./Defines\";\r\nimport { DelegateComponent } from \"./DelegateComponent\";\r\nimport { LayerDialog } from \"./LayerDialog\";\r\nimport { LayerNotify } from \"./LayerNotify\";\r\nimport { LayerPopUp } from \"./LayerPopup\";\r\nimport { LayerUI } from \"./LayerUI\";\r\n\r\n/** 屏幕适配类型 */\r\nexport enum ScreenAdapterType {\r\n    /** 自动适配 */\r\n    Auto,\r\n    /** 横屏适配 */\r\n    Landscape,\r\n    /** 竖屏适配 */\r\n    Portrait\r\n}\r\n\r\n/** 界面层类型 */\r\nexport enum LayerType {\r\n    /** 二维游戏层 */\r\n    Game = \"LayerGame\",\r\n    /** 主界面层 */\r\n    UI = \"LayerUI\",\r\n    /** 弹窗层 */\r\n    PopUp = \"LayerPopUp\",\r\n    /** 模式窗口层 */\r\n    Dialog = \"LayerDialog\",\r\n    /** 系统触发模式窗口层 */\r\n    System = \"LayerSystem\",\r\n    /** 滚动消息提示层 */\r\n    Notify = \"LayerNotify\",\r\n    /** 新手引导层 */\r\n    Guide = \"LayerGuide\"\r\n}\r\n\r\n/** \r\n * 界面配置结构体\r\n * @help    https://gitee.com/dgflash/oops-framework/wikis/pages?sort_id=12037986&doc_id=2873565\r\n * @example\r\n// 界面唯一标识\r\nexport enum UIID {\r\n    Loading = 1,\r\n    Window,\r\n    Netinstable\r\n}\r\n\r\n// 打开界面方式的配置数据\r\nexport var UIConfigData: { [key: number]: UIConfig } = {\r\n    [UIID.Loading]: { layer: LayerType.UI, prefab: \"loading/prefab/loading\", bundle: \"resources\" },\r\n    [UIID.Netinstable]: { layer: LayerType.PopUp, prefab: \"common/prefab/netinstable\" },\r\n    [UIID.Window]: { layer: LayerType.Dialog, prefab: \"common/prefab/window\" }\r\n}\r\n */\r\nexport interface UIConfig {\r\n    /** -----公共属性----- */\r\n    /** 远程包名 */\r\n    bundle?: string;\r\n    /** 窗口层级 */\r\n    layer: LayerType;\r\n    /** 预制资源相对路径 */\r\n    prefab: string;\r\n    /** 是否自动施放（默认不自动释放） */\r\n    destroy?: boolean;\r\n\r\n    /** -----弹窗属性----- */\r\n    /** 是否触摸非窗口区域关闭（默认关闭） */\r\n    vacancy?: boolean,\r\n    /** 是否打开窗口后显示背景遮罩（默认关闭） */\r\n    mask?: boolean;\r\n}\r\n\r\n/** 界面层级管理器 */\r\nexport class LayerManager {\r\n    /** 界面根节点 */\r\n    root!: Node;\r\n    /** 界面摄像机 */\r\n    camera!: Camera;\r\n    /** 游戏界面特效层 */\r\n    game!: Node;\r\n    /** 新手引导层 */\r\n    guide!: Node;\r\n\r\n    /** 窗口宽高比例 */\r\n    windowAspectRatio: number = 0;\r\n    /** 设计宽高比例 */\r\n    designAspectRatio: number = 0;\r\n\r\n    /** 界面层 */\r\n    private readonly ui!: LayerUI;\r\n    /** 弹窗层 */\r\n    private readonly popup!: LayerPopUp;\r\n    /** 只能弹出一个的弹窗 */\r\n    private readonly dialog!: LayerDialog;\r\n    /** 游戏系统提示弹窗  */\r\n    private readonly system!: LayerDialog;\r\n    /** 消息提示控制器，请使用show方法来显示 */\r\n    private readonly notify!: LayerNotify;\r\n    /** UI配置 */\r\n    private configs: { [key: number]: UIConfig } = {};\r\n\r\n    private initScreenAdapter() {\r\n        const drs = view.getDesignResolutionSize();\r\n        const ws = screen.windowSize;\r\n        this.windowAspectRatio = ws.width / ws.height;\r\n        this.designAspectRatio = drs.width / drs.height;\r\n\r\n        let finalW: number = 0;\r\n        let finalH: number = 0;\r\n\r\n        if (this.windowAspectRatio > this.designAspectRatio) {\r\n            finalH = drs.height;\r\n            finalW = finalH * ws.width / ws.height;\r\n            oops.log.logView(\"适配屏幕高度\", \"【横屏】\");\r\n        }\r\n        else {\r\n            finalW = drs.width;\r\n            finalH = finalW * ws.height / ws.width;\r\n            oops.log.logView(\"适配屏幕宽度\", \"【竖屏】\");\r\n        }\r\n        view.setDesignResolutionSize(finalW, finalH, ResolutionPolicy.UNKNOWN);\r\n    }\r\n\r\n    /**\r\n     * 构造函数\r\n     * @param root  界面根节点\r\n     */\r\n    constructor(root: Node) {\r\n        this.root = root;\r\n        this.initScreenAdapter();\r\n        this.camera = this.root.getComponentInChildren(Camera)!;\r\n        this.game = this.create_node(LayerType.Game);\r\n\r\n        this.ui = new LayerUI(LayerType.UI);\r\n        this.popup = new LayerPopUp(LayerType.PopUp);\r\n        this.dialog = new LayerDialog(LayerType.Dialog);\r\n        this.system = new LayerDialog(LayerType.System);\r\n        this.notify = new LayerNotify(LayerType.Notify);\r\n        this.guide = this.create_node(LayerType.Guide);\r\n\r\n        root.addChild(this.game);\r\n        root.addChild(this.ui);\r\n        root.addChild(this.popup);\r\n        root.addChild(this.dialog);\r\n        root.addChild(this.system);\r\n        root.addChild(this.notify);\r\n        root.addChild(this.guide);\r\n    }\r\n\r\n    /**\r\n     * 初始化所有UI的配置对象\r\n     * @param configs 配置对象\r\n     */\r\n    init(configs: { [key: number]: UIConfig }): void {\r\n        this.configs = configs;\r\n    }\r\n\r\n    /**\r\n     * 设置窗口打开失败回调\r\n     * @param callback  回调方法\r\n     */\r\n    setOpenFailure(callback: Function) {\r\n        this.ui.onOpenFailure = this.popup.onOpenFailure = this.dialog.onOpenFailure = this.system.onOpenFailure = callback;\r\n    }\r\n\r\n    /**\r\n     * 渐隐飘过提示\r\n     * @param content 文本表示\r\n     * @param useI18n 是否使用多语言\r\n     * @example \r\n     * oops.gui.toast(\"提示内容\");\r\n     */\r\n    toast(content: string, useI18n: boolean = false) {\r\n        this.notify.toast(content, useI18n)\r\n    }\r\n\r\n    /** 打开等待提示 */\r\n    waitOpen() {\r\n        this.notify.waitOpen();\r\n    }\r\n\r\n    /** 关闭等待提示 */\r\n    waitClose() {\r\n        this.notify.waitClose();\r\n    }\r\n\r\n    /**\r\n     * 设置界面配置\r\n     * @param uiId   要设置的界面id\r\n     * @param config 要设置的配置\r\n     */\r\n    setConfig(uiId: number, config: UIConfig): void {\r\n        this.configs[uiId] = config;\r\n    }\r\n\r\n    /**\r\n     * 同步打开一个窗口\r\n     * @param uiId          窗口唯一编号\r\n     * @param uiArgs        窗口参数\r\n     * @param callbacks     回调对象\r\n     * @example\r\n    var uic: UICallbacks = {\r\n        onAdded: (node: Node, params: any) => {\r\n            var comp = node.getComponent(LoadingViewComp) as ecs.Comp;\r\n        }\r\n        onRemoved:(node: Node | null, params: any) => {\r\n                    \r\n        }\r\n    };\r\n    oops.gui.open(UIID.Loading, null, uic);\r\n     */\r\n    open(uiId: number, uiArgs: any = null, callbacks?: UICallbacks): void {\r\n        const config = this.configs[uiId];\r\n        if (config == null) {\r\n            warn(`打开编号为【${uiId}】的界面失败，配置信息不存在`);\r\n            return;\r\n        }\r\n\r\n        switch (config.layer) {\r\n            case LayerType.UI:\r\n                this.ui.add(config, uiArgs, callbacks);\r\n                break;\r\n            case LayerType.PopUp:\r\n                this.popup.add(config, uiArgs, callbacks);\r\n                break;\r\n            case LayerType.Dialog:\r\n                this.dialog.add(config, uiArgs, callbacks);\r\n                break;\r\n            case LayerType.System:\r\n                this.system.add(config, uiArgs, callbacks);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 异步打开一个窗口\r\n     * @param uiId          窗口唯一编号\r\n     * @param uiArgs        窗口参数\r\n     * @example \r\n     * var node = await oops.gui.openAsync(UIID.Loading);\r\n     */\r\n    async openAsync(uiId: number, uiArgs: any = null): Promise<Node | null> {\r\n        return new Promise<Node | null>((resolve, reject) => {\r\n            const callbacks: UICallbacks = {\r\n                onAdded: (node: Node, params: any) => {\r\n                    resolve(node);\r\n                },\r\n                onLoadFailure: () => {\r\n                    resolve(null);\r\n                }\r\n            };\r\n            this.open(uiId, uiArgs, callbacks);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 场景替换\r\n     * @param removeUiId  移除场景编号\r\n     * @param openUiId    新打开场景编号\r\n     * @param uiArgs      新打开场景参数\r\n     */\r\n    replace(removeUiId: number, openUiId: number, uiArgs: any = null) {\r\n        const callbacks: UICallbacks = {\r\n            onAdded: (node: Node, params: any) => {\r\n                this.remove(removeUiId);\r\n            }\r\n        };\r\n        this.open(openUiId, uiArgs, callbacks);\r\n\r\n    }\r\n\r\n    /**\r\n     * 异步场景替换\r\n     * @param removeUiId  移除场景编号\r\n     * @param openUiId    新打开场景编号\r\n     * @param uiArgs      新打开场景参数\r\n     */\r\n    replaceAsync(removeUiId: number, openUiId: number, uiArgs: any = null): Promise<Node | null> {\r\n        return new Promise<Node | null>(async (resolve, reject) => {\r\n            const node = await this.openAsync(openUiId, uiArgs);\r\n            if (node) {\r\n                this.remove(removeUiId);\r\n                resolve(node);\r\n            }\r\n            else {\r\n                resolve(null);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 缓存中是否存在指定标识的窗口\r\n     * @param uiId 窗口唯一标识\r\n     * @example\r\n     * oops.gui.has(UIID.Loading);\r\n     */\r\n    has(uiId: number): boolean {\r\n        const config = this.configs[uiId];\r\n        if (config == null) {\r\n            warn(`编号为【${uiId}】的界面配置不存在，配置信息不存在`);\r\n            return false;\r\n        }\r\n\r\n        var result = false;\r\n        switch (config.layer) {\r\n            case LayerType.UI:\r\n                result = this.ui.has(config.prefab);\r\n                break;\r\n            case LayerType.PopUp:\r\n                result = this.popup.has(config.prefab);\r\n                break;\r\n            case LayerType.Dialog:\r\n                result = this.dialog.has(config.prefab);\r\n                break;\r\n            case LayerType.System:\r\n                result = this.system.has(config.prefab);\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 缓存中是否存在指定标识的窗口\r\n     * @param uiId 窗口唯一标识\r\n     * @example\r\n     * oops.gui.has(UIID.Loading);\r\n     */\r\n    get(uiId: number): Node {\r\n        const config = this.configs[uiId];\r\n        if (config == null) {\r\n            warn(`编号为【${uiId}】的界面配置不存在，配置信息不存在`);\r\n            return null!;\r\n        }\r\n\r\n        let result: Node = null!;\r\n        switch (config.layer) {\r\n            case LayerType.UI:\r\n                result = this.ui.get(config.prefab);\r\n                break;\r\n            case LayerType.PopUp:\r\n                result = this.popup.get(config.prefab);\r\n                break;\r\n            case LayerType.Dialog:\r\n                result = this.dialog.get(config.prefab);\r\n                break;\r\n            case LayerType.System:\r\n                result = this.system.get(config.prefab);\r\n                break;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 移除指定标识的窗口\r\n     * @param uiId         窗口唯一标识\r\n     * @param isDestroy    移除后是否释放\r\n     * @example\r\n     * oops.gui.remove(UIID.Loading);\r\n     */\r\n    remove(uiId: number, isDestroy?: boolean) {\r\n        const config = this.configs[uiId];\r\n        if (config == null) {\r\n            warn(`删除编号为【${uiId}】的界面失败，配置信息不存在`);\r\n            return;\r\n        }\r\n\r\n        switch (config.layer) {\r\n            case LayerType.UI:\r\n                this.ui.remove(config.prefab, isDestroy);\r\n                break;\r\n            case LayerType.PopUp:\r\n                this.popup.remove(config.prefab, isDestroy);\r\n                break;\r\n            case LayerType.Dialog:\r\n                this.dialog.remove(config.prefab, isDestroy);\r\n                break;\r\n            case LayerType.System:\r\n                this.system.remove(config.prefab, isDestroy);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 删除一个通过this框架添加进来的节点\r\n     * @param node          窗口节点\r\n     * @param isDestroy     移除后是否释放资源\r\n     * @example\r\n     * oops.gui.removeByNode(cc.Node);\r\n     */\r\n    removeByNode(node: Node, isDestroy?: boolean) {\r\n        if (node instanceof Node) {\r\n            let comp = node.getComponent(DelegateComponent);\r\n            if (comp && comp.vp) {\r\n                // 释放显示的界面\r\n                if (node.parent) {\r\n                    (node.parent as LayerUI).remove(comp.vp.config.prefab, isDestroy);\r\n                }\r\n                // 释放缓存中的界面\r\n                else if (isDestroy) {\r\n                    switch (comp.vp.config.layer) {\r\n                        case LayerType.UI:\r\n                            // @ts-ignore 注：不对外使用\r\n                            this.ui.removeCache(comp.vp.config.prefab);\r\n                            break;\r\n                        case LayerType.PopUp:\r\n                            // @ts-ignore 注：不对外使用\r\n                            this.popup.removeCache(comp.vp.config.prefab);\r\n                            break;\r\n                        case LayerType.Dialog:\r\n                            // @ts-ignore 注：不对外使用\r\n                            this.dialog.removeCache(comp.vp.config.prefab);\r\n                            break;\r\n                        case LayerType.System:\r\n                            // @ts-ignore 注：不对外使用\r\n                            this.system.removeCache(comp.vp.config.prefab);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                warn(`当前删除的node不是通过界面管理器添加到舞台上`);\r\n                node.destroy();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 清除所有窗口\r\n     * @param isDestroy 移除后是否释放\r\n     * @example\r\n     * oops.gui.clear();\r\n     */\r\n    clear(isDestroy: boolean = false) {\r\n        this.ui.clear(isDestroy);\r\n        this.popup.clear(isDestroy);\r\n        this.dialog.clear(isDestroy);\r\n        this.system.clear(isDestroy);\r\n    }\r\n\r\n    private create_node(name: string) {\r\n        const node = new Node(name);\r\n        node.layer = Layers.Enum.UI_2D;\r\n        const w: Widget = node.addComponent(Widget);\r\n        w.isAlignLeft = w.isAlignRight = w.isAlignTop = w.isAlignBottom = true;\r\n        w.left = w.right = w.top = w.bottom = 0;\r\n        w.alignMode = 2;\r\n        w.enabled = true;\r\n        return node;\r\n    }\r\n}"]}