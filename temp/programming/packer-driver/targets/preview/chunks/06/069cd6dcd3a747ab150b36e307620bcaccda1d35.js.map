{"version":3,"sources":["file:///G:/sxbs2/sxbs2/assets/module/common/GameComponent.ts"],"names":["Button","Component","EventHandler","Input","Node","SpriteFrame","_decorator","input","isValid","oops","EventDispatcher","EventMessage","resLoader","ViewUtil","ccclass","ResType","GameComponent","_event","nodes","resPaths","event","on","listener","object","off","dispatchEvent","args","getNode","name","get","undefined","nodeTreeInfoLite","Map","node","createPrefabNode","path","bundleName","res","defaultBundleName","createPrefabNodeAsync","getRes","type","addPathToRecord","paths","resId","rps","set","Array","realBundle","index","length","realPath","key","getResKey","has","bundle","load","onProgress","onComplete","Load","loadAsync","loadDir","dir","realDir","LoadDir","release","forEach","value","clear","releaseDir","releaseAudioEffect","Audio","audio","putEffect","setSprite","target","spriteFrame","delete","playMusic","url","callback","playMusicLoop","stopMusic","playEffect","id","setButton","bindRootEvent","EventType","TOUCH_END","self","func","call","regex","buttons","getComponentsInChildren","b","handler","component","match","clickEvents","push","setEvent","console","error","setKeyboard","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","KEY_PRESSING","onKeyPressing","setGameShow","GAME_SHOW","onGameShow","setGameHide","GAME_HIDE","onGameHide","setGameResize","GAME_RESIZE","onGameResize","setGameFullScreen","GAME_FULL_SCREEN","onGameFullScreen","setGameOrientation","GAME_ORIENTATION","onGameOrientation","onDestroy","destroy"],"mappings":"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","sourcesContent":["//cpall\r\nimport { Asset, Button, Component, EventHandler, EventKeyboard, EventTouch, Input, Node, Sprite, SpriteFrame, __private, _decorator, input, isValid } from \"cc\";\r\nimport { oops } from \"../../core/Oops\";\r\nimport { EventDispatcher } from \"../../core/common/event/EventDispatcher\";\r\nimport { EventMessage, ListenerFunc } from \"../../core/common/event/EventMessage\";\r\nimport { AssetType, CompleteCallback, Paths, ProgressCallback, resLoader } from \"../../core/common/loader/ResLoader\";\r\nimport { ViewUtil } from \"../../core/utils/ViewUtil\";\r\n\r\nconst { ccclass } = _decorator;\r\n\r\n/** 加载资源类型 */\r\nenum ResType {\r\n    Load,\r\n    LoadDir,\r\n    Audio\r\n}\r\n\r\n/** 资源加载记录 */\r\ninterface ResRecord {\r\n    /** 资源包名 */\r\n    bundle: string,\r\n    /** 资源路径 */\r\n    path: string,\r\n    /** 资源编号 */\r\n    resId?: number\r\n}\r\n\r\n/** \r\n * 游戏显示对象组件模板\r\n * 1、当前对象加载的资源，会在对象释放时，自动释放引用的资源\r\n * 2、当前对象支持启动游戏引擎提供的各种常用逻辑事件\r\n */\r\n@ccclass(\"GameComponent\")\r\nexport class GameComponent extends Component {\r\n    //#region 全局事件管理\r\n    private _event: EventDispatcher | null = null;\r\n    /** 全局事件管理器 */\r\n    private get event(): EventDispatcher {\r\n        if (this._event == null) this._event = new EventDispatcher();\r\n        return this._event;\r\n    }\r\n\r\n    /**\r\n     * 注册全局事件\r\n     * @param event       事件名\r\n     * @param listener    处理事件的侦听器函数\r\n     * @param object      侦听函数绑定的this对象\r\n     */\r\n    on(event: string, listener: ListenerFunc, object: any) {\r\n        this.event.on(event, listener, object);\r\n    }\r\n\r\n    /**\r\n     * 移除全局事件\r\n     * @param event      事件名\r\n     */\r\n    off(event: string) {\r\n        this.event.off(event);\r\n    }\r\n\r\n    /** \r\n     * 触发全局事件 \r\n     * @param event      事件名\r\n     * @param args       事件参数\r\n     */\r\n    dispatchEvent(event: string, ...args: any) {\r\n        this.event.dispatchEvent(event, ...args);\r\n    }\r\n    //#endregion\r\n\r\n    //#region 预制节点管理\r\n\r\n    /** 摊平的节点集合（所有节点不能重名） */\r\n    private nodes: Map<string, Node> = null!;\r\n\r\n    /** 通过节点名获取预制上的节点，整个预制不能有重名节点 */\r\n    getNode(name: string): Node | undefined {\r\n        if (this.nodes) {\r\n            return this.nodes.get(name);\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    /** 平摊所有节点存到Map<string, Node>中通过get(name: string)方法获取 */\r\n    nodeTreeInfoLite() {\r\n        this.nodes = new Map();\r\n        ViewUtil.nodeTreeInfoLite(this.node, this.nodes);\r\n    }\r\n\r\n    /**\r\n     * 从资源缓存中找到预制资源名并创建一个显示对象\r\n     * @param path 资源路径\r\n     */\r\n    createPrefabNode(path: string, bundleName: string = oops.res.defaultBundleName): Node {\r\n        return ViewUtil.createPrefabNode(path, bundleName);\r\n    }\r\n\r\n    /**\r\n     * 加载预制并创建预制节点\r\n     * @param path       资源路径\r\n     * @param bundleName 资源包名\r\n     */\r\n    createPrefabNodeAsync(path: string, bundleName: string = oops.res.defaultBundleName): Promise<Node> {\r\n        return ViewUtil.createPrefabNodeAsync(path, bundleName);\r\n    }\r\n    //#endregion\r\n\r\n    //#region 资源加载管理\r\n    /** 资源路径 */\r\n    private resPaths: Map<ResType, Map<string, ResRecord>> = null!;             // 资源使用记录\r\n\r\n    /**\r\n     * 获取资源\r\n     * @param path          资源路径\r\n     * @param type          资源类型\r\n     * @param bundleName    远程资源包名\r\n     */\r\n    getRes<T extends Asset>(path: string, type?: __private.__types_globals__Constructor<T> | null, bundleName?: string): T | null {\r\n        return oops.res.get(path, type, bundleName);\r\n    }\r\n\r\n    /**\r\n     * 添加资源使用记录\r\n     * @param type          资源类型\r\n     * @param bundleName    资源包名\r\n     * @param paths         资源路径\r\n     */\r\n    private addPathToRecord<T>(type: ResType, bundleName: string, paths?: string | string[] | AssetType<T> | ProgressCallback | CompleteCallback | null, resId?: number) {\r\n        if (this.resPaths == null) this.resPaths = new Map();\r\n\r\n        var rps = this.resPaths.get(type);\r\n        if (rps == null) {\r\n            rps = new Map();\r\n            this.resPaths.set(type, rps);\r\n        }\r\n\r\n        if (paths instanceof Array) {\r\n            let realBundle = bundleName;\r\n            for (let index = 0; index < paths.length; index++) {\r\n                let realPath = paths[index];\r\n                let key = this.getResKey(realBundle, realPath, resId);\r\n                if (!rps.has(key)) {\r\n                    rps.set(key, { path: realPath, bundle: realBundle, resId: resId });\r\n                }\r\n            }\r\n        }\r\n        else if (typeof paths === \"string\") {\r\n            let realBundle = bundleName;\r\n            let realPath = paths;\r\n            let key = this.getResKey(realBundle, realPath, resId);\r\n            if (!rps.has(key)) {\r\n                rps.set(key, { path: realPath, bundle: realBundle, resId: resId });\r\n            }\r\n        }\r\n        else {\r\n            let realBundle = oops.res.defaultBundleName;\r\n            let realPath = bundleName;\r\n            let key = this.getResKey(realBundle, realPath, resId);\r\n            if (!rps.has(key)) {\r\n                rps.set(key, { path: realPath, bundle: realBundle, resId: resId });\r\n            }\r\n        }\r\n    }\r\n\r\n    private getResKey(realBundle: string, realPath: string, resId?: number): string {\r\n        let key = `${realBundle}:${realPath}`;\r\n        if (resId != null) key += \":\" + resId;\r\n        return key;\r\n    }\r\n\r\n    /**\r\n     * 加载一个资源\r\n     * @param bundleName    远程包名\r\n     * @param paths         资源路径\r\n     * @param type          资源类型\r\n     * @param onProgress    加载进度回调\r\n     * @param onComplete    加载完成回调\r\n     */\r\n    load<T extends Asset>(bundleName: string, paths: Paths, type: AssetType<T>, onProgress: ProgressCallback, onComplete: CompleteCallback): void;\r\n    load<T extends Asset>(bundleName: string, paths: Paths, onProgress: ProgressCallback, onComplete: CompleteCallback): void;\r\n    load<T extends Asset>(bundleName: string, paths: Paths, onComplete?: CompleteCallback): void;\r\n    load<T extends Asset>(bundleName: string, paths: Paths, type: AssetType<T>, onComplete?: CompleteCallback): void;\r\n    load<T extends Asset>(paths: Paths, type: AssetType<T>, onProgress: ProgressCallback, onComplete: CompleteCallback): void;\r\n    load<T extends Asset>(paths: Paths, onProgress: ProgressCallback, onComplete: CompleteCallback): void;\r\n    load<T extends Asset>(paths: Paths, onComplete?: CompleteCallback): void;\r\n    load<T extends Asset>(paths: Paths, type: AssetType<T>, onComplete?: CompleteCallback): void;\r\n    load<T extends Asset>(\r\n        bundleName: string,\r\n        paths?: Paths | AssetType<T> | ProgressCallback | CompleteCallback,\r\n        type?: AssetType<T> | ProgressCallback | CompleteCallback,\r\n        onProgress?: ProgressCallback | CompleteCallback,\r\n        onComplete?: CompleteCallback,\r\n    ) {\r\n        this.addPathToRecord(ResType.Load, bundleName, paths);\r\n        oops.res.load(bundleName, paths, type, onProgress, onComplete);\r\n    }\r\n\r\n    /**\r\n     * 异步加载一个资源\r\n     * @param bundleName    远程包名\r\n     * @param paths         资源路径\r\n     * @param type          资源类型\r\n     */\r\n    loadAsync<T extends Asset>(bundleName: string, paths: Paths, type: AssetType<T>): Promise<T>;\r\n    loadAsync<T extends Asset>(bundleName: string, paths: Paths): Promise<T>;\r\n    loadAsync<T extends Asset>(paths: Paths, type: AssetType<T>): Promise<T>;\r\n    loadAsync<T extends Asset>(paths: Paths): Promise<T>;\r\n    loadAsync<T extends Asset>(bundleName: string,\r\n        paths?: Paths | AssetType<T> | ProgressCallback | CompleteCallback,\r\n        type?: AssetType<T> | ProgressCallback | CompleteCallback): Promise<T> {\r\n        this.addPathToRecord(ResType.Load, bundleName, paths);\r\n        return oops.res.loadAsync(bundleName, paths, type);\r\n    }\r\n\r\n    /**\r\n     * 加载文件夹中的资源\r\n     * @param bundleName    远程包名\r\n     * @param dir           文件夹名\r\n     * @param type          资源类型\r\n     * @param onProgress    加载进度回调\r\n     * @param onComplete    加载完成回调\r\n     */\r\n    loadDir<T extends Asset>(bundleName: string, dir: string, type: AssetType<T>, onProgress: ProgressCallback, onComplete: CompleteCallback): void;\r\n    loadDir<T extends Asset>(bundleName: string, dir: string, onProgress: ProgressCallback, onComplete: CompleteCallback): void;\r\n    loadDir<T extends Asset>(bundleName: string, dir: string, onComplete?: CompleteCallback): void;\r\n    loadDir<T extends Asset>(bundleName: string, dir: string, type: AssetType<T>, onComplete?: CompleteCallback): void;\r\n    loadDir<T extends Asset>(dir: string, type: AssetType<T>, onProgress: ProgressCallback, onComplete: CompleteCallback): void;\r\n    loadDir<T extends Asset>(dir: string, onProgress: ProgressCallback, onComplete: CompleteCallback): void;\r\n    loadDir<T extends Asset>(dir: string, onComplete?: CompleteCallback): void;\r\n    loadDir<T extends Asset>(dir: string, type: AssetType<T>, onComplete?: CompleteCallback): void;\r\n    loadDir<T extends Asset>(\r\n        bundleName: string,\r\n        dir?: string | AssetType<T> | ProgressCallback | CompleteCallback,\r\n        type?: AssetType<T> | ProgressCallback | CompleteCallback,\r\n        onProgress?: ProgressCallback | CompleteCallback,\r\n        onComplete?: CompleteCallback,\r\n    ) {\r\n        let realDir: string;\r\n        let realBundle: string;\r\n        if (typeof dir === \"string\") {\r\n            realDir = dir;\r\n            realBundle = bundleName;\r\n        }\r\n        else {\r\n            realDir = bundleName;\r\n            realBundle = oops.res.defaultBundleName;\r\n        }\r\n\r\n        this.addPathToRecord(ResType.LoadDir, realBundle, realDir);\r\n        oops.res.loadDir(bundleName, dir, type, onProgress, onComplete);\r\n    }\r\n\r\n    /** 释放资源 */\r\n    release() {\r\n        if (this.resPaths) {\r\n            const rps = this.resPaths.get(ResType.Load);\r\n            if (rps) {\r\n                rps.forEach((value: ResRecord) => {\r\n                    oops.res.release(value.path, value.bundle);\r\n                });\r\n                rps.clear();\r\n            }\r\n        }\r\n    }\r\n\r\n    /** 释放文件夹的资源 */\r\n    releaseDir() {\r\n        if (this.resPaths) {\r\n            const rps = this.resPaths.get(ResType.LoadDir);\r\n            if (rps) {\r\n                rps.forEach((value: ResRecord) => {\r\n                    oops.res.releaseDir(value.path, value.bundle);\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    /** 释放音效资源 */\r\n    releaseAudioEffect() {\r\n        if (this.resPaths) {\r\n            const rps = this.resPaths.get(ResType.Audio);\r\n            if (rps) {\r\n                rps.forEach((value: ResRecord) => {\r\n                    oops.audio.putEffect(value.resId!, value.path, value.bundle);\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置图片资源\r\n     * @param target  目标精灵对象\r\n     * @param path    图片资源地址\r\n     * @param bundle  资源包名\r\n     */\r\n    async setSprite(target: Sprite, path: string, bundle: string = resLoader.defaultBundleName) {\r\n        const spriteFrame = await this.loadAsync(bundle, path, SpriteFrame);\r\n        if (!spriteFrame || !isValid(target)) {\r\n            const rps = this.resPaths.get(ResType.Load);\r\n            if (rps) {\r\n                const key = this.getResKey(bundle, path);\r\n                rps.delete(key);\r\n                oops.res.release(path, bundle);\r\n            }\r\n            return;\r\n        }\r\n        target.spriteFrame = spriteFrame;\r\n    }\r\n    //#endregion\r\n\r\n    //#region 音频播放管理\r\n    /**\r\n     * 播放背景音乐（不受自动释放资源管理）\r\n     * @param url           资源地址\r\n     * @param callback      资源加载完成回调\r\n     * @param bundleName    资源包名\r\n     */\r\n    playMusic(url: string, callback?: Function, bundleName?: string) {\r\n        oops.audio.playMusic(url, callback, bundleName);\r\n    }\r\n\r\n    /**\r\n     * 循环播放背景音乐（不受自动释放资源管理）\r\n     * @param url           资源地址\r\n     * @param bundleName    资源包名\r\n     */\r\n    playMusicLoop(url: string, bundleName?: string) {\r\n        oops.audio.stopMusic();\r\n        oops.audio.playMusicLoop(url, bundleName);\r\n    }\r\n\r\n    /**\r\n     * 播放音效\r\n     * @param url           资源地址\r\n     * @param callback      资源加载完成回调\r\n     * @param bundleName    资源包名\r\n     */\r\n    async playEffect(url: string, bundleName?: string) {\r\n        if (bundleName == null) bundleName = oops.res.defaultBundleName;\r\n        const id = await oops.audio.playEffect(url, bundleName, () => {\r\n            const rps = this.resPaths.get(ResType.Audio);\r\n            if (rps) {\r\n                const key = this.getResKey(bundleName, url, id);\r\n                rps.delete(key);\r\n            }\r\n        });\r\n        this.addPathToRecord(ResType.Audio, bundleName, url, id);\r\n    }\r\n    //#endregion\r\n\r\n    //#region 游戏逻辑事件\r\n    /** \r\n     * 批量设置当前界面按钮事件\r\n     * @param bindRootEvent  是否对预制根节点绑定触摸事件\r\n     * @example\r\n     * 注：按钮节点Label1、Label2必须绑定UIButton等类型的按钮组件才会生效，方法名必须与节点名一致\r\n     * this.setButton();\r\n     * \r\n     * Label1(event: EventTouch) { console.log(event.target.name); }\r\n     * Label2(event: EventTouch) { console.log(event.target.name); }\r\n     */\r\n    protected setButton(bindRootEvent: boolean = true) {\r\n        // 自定义按钮批量绑定触摸事件\r\n        if (bindRootEvent) {\r\n            this.node.on(Node.EventType.TOUCH_END, (event: EventTouch) => {\r\n                const self: any = this;\r\n                const func = self[event.target.name];\r\n                if (func) {\r\n                    func.call(this, event);\r\n                }\r\n                // 不触发界面根节点触摸事件、不触发长按钮组件的触摸事件\r\n                // else if (event.target != this.node && event.target.getComponent(ButtonTouchLong) == null) {\r\n                //     console.warn(`名为【${event.target.name}】的按钮事件方法不存在`);\r\n                // }\r\n            }, this);\r\n        }\r\n\r\n        // Cocos Creator Button组件批量绑定触摸事件（使用UIButton支持放连点功能）\r\n        const regex = /<([^>]+)>/;\r\n        const buttons = this.node.getComponentsInChildren<Button>(Button);\r\n        buttons.forEach((b: Button) => {\r\n            const node = b.node;\r\n            const self: any = this;\r\n            const func = self[node.name];\r\n            if (func) {\r\n                const event = new EventHandler();\r\n                event.target = this.node;\r\n                event.handler = b.node.name;\r\n                event.component = this.name.match(regex)![1];\r\n                b.clickEvents.push(event);\r\n            }\r\n            // else {\r\n            //     console.warn(`名为【${node.name}】的按钮事件方法不存在`);\r\n            // }\r\n        });\r\n    }\r\n\r\n    /** \r\n     * 批量设置全局事件 \r\n     * @example\r\n     *  this.setEvent(\"onGlobal\");\r\n     *  this.dispatchEvent(\"onGlobal\", \"全局事件\");\r\n     * \r\n     *  onGlobal(event: string, args: any) { console.log(args) };\r\n     */\r\n    protected setEvent(...args: string[]) {\r\n        const self: any = this;\r\n        for (const name of args) {\r\n            const func = self[name];\r\n            if (func)\r\n                this.on(name, func, this);\r\n            else\r\n                console.error(`名为【${name}】的全局事方法不存在`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 键盘事件开关\r\n     * @param on 打开键盘事件为true\r\n     */\r\n    setKeyboard(on: boolean) {\r\n        if (on) {\r\n            input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this);\r\n            input.on(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n            input.on(Input.EventType.KEY_PRESSING, this.onKeyPressing, this);\r\n        }\r\n        else {\r\n            input.off(Input.EventType.KEY_DOWN, this.onKeyDown, this);\r\n            input.off(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n            input.off(Input.EventType.KEY_PRESSING, this.onKeyPressing, this);\r\n        }\r\n    }\r\n\r\n    /** 键按下 */\r\n    protected onKeyDown(event: EventKeyboard) { }\r\n\r\n    /** 键放开 */\r\n    protected onKeyUp(event: EventKeyboard) { }\r\n\r\n    /** 键长按 */\r\n    protected onKeyPressing(event: EventKeyboard) { }\r\n\r\n    /** 监听游戏从后台进入事件 */\r\n    protected setGameShow() {\r\n        this.on(EventMessage.GAME_SHOW, this.onGameShow, this);\r\n    }\r\n\r\n    /** 监听游戏切到后台事件 */\r\n    protected setGameHide() {\r\n        this.on(EventMessage.GAME_HIDE, this.onGameHide, this);\r\n    }\r\n\r\n    /** 监听游戏画笔尺寸变化事件 */\r\n    protected setGameResize() {\r\n        this.on(EventMessage.GAME_RESIZE, this.onGameResize, this);\r\n    }\r\n\r\n    /** 监听游戏全屏事件 */\r\n    protected setGameFullScreen() {\r\n        this.on(EventMessage.GAME_FULL_SCREEN, this.onGameFullScreen, this);\r\n    }\r\n\r\n    /** 监听游戏旋转屏幕事件 */\r\n    protected setGameOrientation() {\r\n        this.on(EventMessage.GAME_ORIENTATION, this.onGameOrientation, this);\r\n    }\r\n\r\n    /** 游戏从后台进入事件回调 */\r\n    protected onGameShow(): void { }\r\n\r\n    /** 游戏切到后台事件回调 */\r\n    protected onGameHide(): void { }\r\n\r\n    /** 游戏画笔尺寸变化事件回调 */\r\n    protected onGameResize(): void { }\r\n\r\n    /** 游戏全屏事件回调 */\r\n    protected onGameFullScreen(): void { }\r\n\r\n    /** 游戏旋转屏幕事件回调 */\r\n    protected onGameOrientation(): void { }\r\n    //#endregion\r\n\r\n    protected onDestroy() {\r\n        // 释放消息对象\r\n        if (this._event) {\r\n            this._event.destroy();\r\n            this._event = null;\r\n        }\r\n\r\n        // 节点引用数据清除\r\n        if (this.nodes) {\r\n            this.nodes.clear();\r\n            this.nodes = null!;\r\n        }\r\n\r\n        // 自动释放资源\r\n        if (this.resPaths) {\r\n            this.releaseAudioEffect();\r\n            this.release();\r\n            this.releaseDir();\r\n            this.resPaths.clear();\r\n            this.resPaths = null!;\r\n        }\r\n    }\r\n}"]}