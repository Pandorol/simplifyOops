{"version":3,"sources":["file:///G:/sxbs2/sxbs2/assets/core/gui/layer/LayerNotify.ts"],"names":["LayerNotify","BlockInputEvents","Layers","Node","Widget","instantiate","ViewUtil","Notify","ToastPrefabPath","WaitPrefabPath","constructor","name","black","wait","notify","notifyItem","widget","addComponent","isAlignLeft","isAlignRight","isAlignTop","isAlignBottom","left","right","top","bottom","alignMode","enabled","init","layer","Enum","UI_2D","waitOpen","createPrefabNode","parent","waitClose","toast","content","useI18n","children","childNode","prompt","getChildByName","toastCom","getComponent","onComplete","length","destroy"],"mappings":"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","sourcesContent":["//cpall\r\nimport { BlockInputEvents, Layers, Node, Widget, instantiate } from \"cc\";\r\nimport { ViewUtil } from \"../../utils/ViewUtil\";\r\nimport { Notify } from \"../prompt/Notify\";\r\n\r\nconst ToastPrefabPath: string = 'common/prefab/notify';\r\nconst WaitPrefabPath: string = 'common/prefab/wait';\r\n\r\n/*\r\n * 滚动消息提示层\r\n */\r\nexport class LayerNotify extends Node {\r\n    private black!: BlockInputEvents;\r\n    /** 等待提示资源 */\r\n    private wait: Node = null!;\r\n    /** 自定义弹出提示资源 */\r\n    private notify: Node = null!;\r\n    /** 自定义弹出提示内容资源 */\r\n    private notifyItem: Node = null!;\r\n\r\n    constructor(name: string) {\r\n        super(name);\r\n\r\n        const widget: Widget = this.addComponent(Widget);\r\n        widget.isAlignLeft = widget.isAlignRight = widget.isAlignTop = widget.isAlignBottom = true;\r\n        widget.left = widget.right = widget.top = widget.bottom = 0;\r\n        widget.alignMode = 2;\r\n        widget.enabled = true;\r\n        this.init();\r\n    }\r\n\r\n    private init() {\r\n        this.layer = Layers.Enum.UI_2D;\r\n        this.black = this.addComponent(BlockInputEvents);\r\n        this.black.enabled = false;\r\n    }\r\n\r\n    /** 打开等待提示 */\r\n    waitOpen() {\r\n        if (this.wait == null) this.wait = ViewUtil.createPrefabNode(WaitPrefabPath);\r\n        if (this.wait.parent == null) {\r\n            this.wait.parent = this;\r\n            this.black.enabled = true;\r\n        }\r\n    }\r\n\r\n    /** 关闭等待提示 */\r\n    waitClose() {\r\n        if (this.wait && this.wait.parent) {\r\n            this.wait.parent = null;\r\n            this.black.enabled = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 渐隐飘过提示\r\n     * @param content 文本表示\r\n     * @param useI18n 是否使用多语言\r\n     */\r\n    toast(content: string, useI18n: boolean) {\r\n        if (this.notify == null) {\r\n            this.notify = ViewUtil.createPrefabNode(ToastPrefabPath);\r\n            this.notifyItem = this.notify.children[0];\r\n            this.notifyItem.parent = null;\r\n        }\r\n\r\n        this.notify.parent = this;\r\n        let childNode = instantiate(this.notifyItem);\r\n        let prompt = childNode.getChildByName(\"prompt\")!;\r\n        let toastCom = prompt.getComponent(Notify)!;\r\n        childNode.parent = this.notify;\r\n\r\n        toastCom.onComplete = () => {\r\n            if (this.notify.children.length == 0) {\r\n                this.notify.parent = null;\r\n            }\r\n        };\r\n        toastCom.toast(content, useI18n);\r\n\r\n        // 超过3个提示，就施放第一个提示\r\n        if (this.notify.children.length > 3) {\r\n            this.notify.children[0].destroy();\r\n        }\r\n    }\r\n}"]}